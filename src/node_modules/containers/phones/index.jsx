import React, { Component } from 'react';
import { connect } from 'react-redux';
import * as R from 'ramda';

import { fetchPhones, loadMorePhones } from 'actions';
import { getPhones } from 'selectors/phoneSelector';
import {Link} from 'react-router-dom';
import Layout from 'containers/layout';

class Phones extends Component {

  componentDidMount() {
    this.props.fetchPhones();

  }

  renderPhone(phone, ind) {
    if(phone) {
      let shortDesc = phone && `${R.take(60, phone.description)}...`;
      return (
          <div className="col-sm-4 col-md-4 col-lg-4 book-list" key={ind}>
            <div className="thumbnail">
              <img
                className="img"
                src={phone.image}
                alt={"img-" + phone.name}
              />
            </div>
            <div className="caption">
              <h4 className="pull-right">${phone.price}</h4>
              <h4>
                <Link to={`/phones/${phone.id}`}>
                  {phone.name}
                </Link>
              </h4>
              <p>{shortDesc}</p>
              <p className="item">
                <button className="btn btn-primary">Buy now!</button>
                <Link
                  to={`/phones/${phone.id}`}
                  className="btn btn-default"
                >
                  More info
                </Link>
              </p>
            </div>
          </div>
      )
    }
  }

  render() {
    const { phones, loadMorePhones } = this.props;

    return (
      <Layout>
        <div className="books row">
          {phones.map((phone, ind) => this.renderPhone(phone, ind))}
        </div>
        <div className="row">
          <div className="com-md-12">
            <button className='pull-right btn btn-primary' onClick={loadMorePhones}>
              Show more!
            </button>
          </div>
        </div>
      </Layout>
    )
  }
}

const mapStateToProps = state => {
  return {
    phones: getPhones(state)
  }
};

const mapDispatchToProps = {
  fetchPhones,
  loadMorePhones
};

export default connect(mapStateToProps, mapDispatchToProps)(Phones);
